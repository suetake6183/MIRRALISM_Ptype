# MIRRALISM プロトタイプ設計書 v3.0

**作成日**: 2025年6月10日  
**目的**: AIとの対話における文脈維持と情報構造化による価値創造  
**開発期間**: 1週間（MVP）

---

## 1. プロジェクト概要

### 1.1 解決する核心課題
1. **AIとの対話で目的・文脈を見失う**
   - 長い会話で本来の目的から脱線
   - 局所的な問題解決に没頭して全体を見失う

2. **クライアント情報の非構造化による提案品質低下**
   - 会話内容が整理されず活用困難
   - 重要な要望・課題が埋もれる

3. **情報散在による同じミスの繰り返し**
   - 100個近い重複機能の作成
   - 一時ファイルの散乱
   - 過去の失敗パターンの繰り返し

### 1.2 プロトタイプの価値提案
- 会話の文脈を常に維持
- 提案作成時間を50%以上短縮
- 情報の一元管理による品質向上

---

## 2. MVP機能定義

### 2.1 TaskMaster統合機能
**目的**: 現在地と目的地の常時把握

```yaml
機能:
  - 現在のタスク・目的の常時表示
  - 会話履歴と文脈の保持
  - 次のアクションの明確化
  
実装:
  - 既存TaskMaster APIとの連携
  - 画面上部に常時表示バー
  - タスク逸脱時のアラート
```

### 2.2 会話構造化エンジン
**目的**: クライアント要望の自動整理

```yaml
入力:
  - 会話テキスト（Aqua Voice経由）
  - ファイルアップロード
  - URL指定

処理:
  - Claude APIによる自動構造化
  - 以下の要素を抽出:
    * 目標（何を達成したいか）
    * 課題（何が障害か）
    * 解決策（どうすればよいか）
    * コスト（必要な資源）
    * 時間（必要な期間）
    * パフォーマンス（期待効果）

出力:
  - 構造化されたJSON/Markdown
  - 視覚的なサマリー表示
```

### 2.3 情報一元管理システム
**目的**: 情報散在の完全防止

```yaml
ディレクトリ構造:
  /MIRRALISM/
  ├── /input/    # 生データ置き場
  ├── /process/  # 処理中データ
  ├── /output/   # 構造化済みデータ
  └── /config/   # 設定ファイル
      └── config.yaml  # 統一設定

機能:
  - 重複防止チェック
  - バージョン管理
  - 高速検索（ファイル名・内容）
  - 関連情報の自動表示
```

---

## 3. 技術構成

### 3.1 開発環境
```yaml
AI開発:
  - Claude Code（メイン開発）
  - Cursor（補助開発）
  
言語・フレームワーク:
  - Backend: Python/Node.js
  - Frontend: シンプルHTML/CSS/JS
  - Database: ファイルベース（初期）
  
API:
  - Claude API（構造化処理）
  - TaskMaster API（タスク管理）
```

### 3.2 品質保証（統合テスト）
```yaml
テストスイート:
  IntegrationTestRunner:
    - TaskMaster接続テスト
    - データフロー検証
    - API応答確認
  
  ScenarioTestSuite:
    - 会話入力→構造化→保存
    - 検索→取得→表示
    - エラーハンドリング
  
  PerformanceTestSuite:
    - 処理時間測定（目標：3秒以内）
    - 同時処理数確認
    - メモリ使用量監視
  
  SecurityTestSuite:
    - データ暗号化確認
    - アクセス制御検証
    - インジェクション対策
  
  CompatibilityTestSuite:
    - Claude API互換性
    - ブラウザ互換性
    - データ形式互換性

実行ルール:
  - 新機能追加前に必ずテスト作成
  - Claude Codeにテスト実行を指示
  - 全テストパス後のみコミット
```

---

## 4. 実装計画（1週間）

### Day 1-2: 基盤構築
```yaml
月曜日:
  - プロジェクト構造作成
  - TaskMaster API接続確認
  - ディレクトリ構造実装
  - config.yaml作成

火曜日:
  - Claude API接続設定
  - 基本的な入出力UI作成
  - テストスイート基盤構築
```

### Day 3-4: コア機能実装
```yaml
水曜日:
  - 構造化プロンプト作成・調整
  - データ保存機能実装
  - 基本的な検索機能

木曜日:
  - TaskMaster統合完成
  - エラーハンドリング実装
  - 統合テスト実行
```

### Day 5-7: 統合・実運用
```yaml
金曜日:
  - 黒澤工務店データでテスト
  - バグ修正・調整
  - ドキュメント作成

週末:
  - 実運用開始
  - フィードバック収集
  - Issue.md整理
```

---

## 5. 問題対処フレームワーク

### 5.1 問題発生時の鉄則
```yaml
絶対ルール:
  1. 立ち止まる: 問題に遭遇したら一旦停止
  2. 記録する: Issue.mdに記録（解決はしない）
  3. 判定する: MVP必須か？後回し可能か？
  4. 続行する: MVP必須以外は迂回して続行
```

### 5.2 判定基準
```yaml
MVP必須（即対応）:
  - TaskMaster接続が動かない
  - データが保存できない
  - 構造化が全くできない

後回し可能（Issue.mdへ）:
  - UI/UXの改善要望
  - 追加機能のアイデア
  - パフォーマンス最適化
  - エッジケース対応
```

### 5.3 Issue.md運用
```markdown
## 未解決Issue一覧
- [ ] #001: [問題の内容] (発見日: YYYY-MM-DD)
- [ ] #002: [改善アイデア] (提案日: YYYY-MM-DD)

## MVP完了後の優先順位
1. [最重要改善]
2. [次点]
```

---

## 6. 一時ファイル管理戦略

### 6.1 ディレクトリ構造の厳格化
```
/MIRRALISM/
├── /src/          # ソースコードのみ
├── /data/         # 永続データのみ
├── /docs/         # 正式ドキュメントのみ
└── /tmp/          # 全ての一時ファイル
    ├── /daily/    # 日付フォルダ自動生成
    │   └── /2025-06-10/
    │       ├── test_*.md
    │       ├── memo_*.txt
    │       └── report_*.md
    └── /archive/  # 7日経過で自動移動
```

### 6.2 一時ファイル命名規則
```yaml
必須プレフィックス:
  test_   : テスト関連
  memo_   : メモ・思考整理
  draft_  : 下書き・草稿
  temp_   : その他一時ファイル
  
例: test_claude_api_20250610.md
```

### 6.3 自動クリーンアップ
```yaml
実行タイミング: 毎回起動時
処理内容:
  1. 7日以上前の/daily/を/archive/へ
  2. 30日以上前の/archive/を削除
  3. ルートの迷子ファイルを/tmp/へ強制移動
```

---

## 7. 過去資産の活用戦略

### 7.1 レガシーデータ管理構造
```
/MIRRALISM/
├── /legacy/       # 過去データ置き場（読み取り専用）
│   ├── /evaluated/   # 評価済み（使える）
│   │   ├── taskmaster_integration/
│   │   ├── useful_functions/
│   │   └── README.md  # 各資産の説明
│   ├── /pending/     # 未評価
│   └── /rejected/    # 評価済み（使えない）
```

### 7.2 過去資産の取り扱いルール
```yaml
評価プロセス:
  1. /legacy/pending/ に一旦全て配置
  2. 必要時のみ評価実施（深追い禁止）
  3. 使える部分のみ /evaluated/ へ
  4. 使えないものは /rejected/ へ

移植ルール:
  - コピー禁止（参照・インポートのみ）
  - 必ず使用記録を残す（used_legacy.md）
  - 改修時は新規作成（元ファイル変更禁止）
  
使用記録フォーマット:
  日付: 2025-06-10
  使用元: /legacy/evaluated/taskmaster_integration/api.py
  使用先: /src/taskmaster_connector.py
  使用内容: API接続部分のロジック
  改修内容: エラーハンドリング追加
```

### 7.3 評価基準
```yaml
即使用可能（/evaluated行き）:
  - TaskMaster関連コード
  - 動作確認済みのユーティリティ
  - ドキュメント・設計資料

要検討（/pending残留）:
  - 未テストの機能
  - 依存関係が不明なコード
  - 目的が不明確な機能

使用不可（/rejected行き）:
  - 重複機能
  - 古いAPIバージョン依存
  - 設計思想が異なるもの
```

---

## 8. MVP成功判定基準

### 7.1 1週間後の成功条件
```yaml
必須達成:
  ✓ 黒澤工務店の会話データ1件を構造化できる
  ✓ TaskMasterで現在地を見失わない
  ✓ 保存したデータを検索・取得できる
  
成功の証明:
  ✓ 実際の提案書作成が30分→15分に短縮
  ✓ 「使い続けたい」と思える
  ✓ 新しいミスが発生しない
```

### 7.2 定量的評価指標
```yaml
処理性能:
  - 構造化処理: 3秒以内
  - 検索応答: 1秒以内
  - システム稼働率: 95%以上

品質指標:
  - 構造化精度: 80%以上
  - エラー発生率: 5%以下
  - ユーザー満足度: 継続使用意向
```

---

## 9. 制約事項・前提条件

### 8.1 制約事項
- 開発期間: 1週間厳守
- 開発リソース: 1人（1日10時間）
- 既存ツール活用優先（車輪の再発明禁止）

### 8.2 前提条件
- TaskMaster実装済み・API利用可能
- Claude API利用環境整備済み
- Aqua Voiceによる音声→テキスト変換済み

---

## 10. リスク管理

### 10.1 技術リスク
```yaml
リスク:
  - Claude API制限・コスト
  - TaskMaster統合の複雑性
  - パフォーマンス問題

対策:
  - API使用量監視・アラート設定
  - 段階的統合・フォールバック準備
  - 初期は小規模データでテスト
```

### 10.2 スケジュールリスク
```yaml
リスク:
  - 機能追加要望による遅延
  - 技術的問題による停滞
  - テスト不足による品質問題

対策:
  - MVP機能の厳格な固定
  - Issue.mdによる後回し管理
  - 自動テストによる品質担保
```

---

## 11. 次のアクション

1. **本日中**: プロジェクト構造作成・環境設定
2. **明日まで**: TaskMaster接続確認・基本UI作成
3. **水曜まで**: 構造化エンジンのプロトタイプ完成

**開発開始宣言**: この設計書承認後、即座に実装開始

---

*この設計書は生きたドキュメントとして、実装中の学びを反映して更新される*